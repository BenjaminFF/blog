# 运算符

## 赋值运算符（assignment operator）
一个 赋值运算符将它右边操作数的值赋给它左边的操作数。

```js
x=y;
```

还有一些复合赋值运算符

```js
x+=y  //x=x+y
x**=y //x=x**y
x^=y //x=x^y
```

更复杂的赋值（解构）
```js
var foo = ["one", "two", "three"];

// 不使用解构
var one   = foo[0];
var two   = foo[1];
var three = foo[2];

// 使用解构
var [one, two, three] = foo;
```

## 比较运算符
比较运算符比较它的操作数并返回一个基于表达式是否为真的逻辑值。操作数可以是数字，字符串，逻辑，对象值。字符串比较是基于标准的字典顺序，使用Unicode值。

JavaScript 有两种比较方式：严格比较运算符和转换类型比较运算符。对于严格比较运算符（===）来说，仅当两个操作数的类型相同且值相等为 true，而对于被广泛使用的比较运算符（==）来说，会在进行比较之前，将两个操作数转换成相同的类型。

### 转换类型比较运算符（==）
比较操作符会为两个不同类型的操作数转换类型，然后进行严格比较。当两个操作数都是对象时，JavaScript会比较其内部引用，当且仅当他们的引用指向内存中的相同对象（区域）时才相等，即他们在栈内存中的引用地址相同。

```js
let obj1 = {};
let obj2 = {};

console.log(obj1 == obj2);       //false
```

### 转换比较运算符算法
```js
//伪代码.........
//x和y类型相同的时候
if Type(x) equals Type(y)
  if Type(x) is Undefined or Null 
  return true

  //Number类型
  if Type(x) is Number
     if x or y is NaN
     return false
     if value(x) equals value(y)
     return true
     if x equals -0 and y equals +0
     return true
     if y equals -0 and x equals +0
     return true
     else
     return false
  
  //String类型
  if Type(x) is String
  return String.equals(x,y)  //x,y的字符串长度相等并且每个位置的字符相等

  //Boolean类型
  if Type(x) is Boolean
     if x and y equals true
     return true
     if x and y equals false
     return true
     else
     return false
  
  //Object类型
  if x and y refers same object  //x和y引用都指向同一个对象
  return true
  else 
  return false

//x和y分别为null或者undefined的时候
if x euqals null and y euqals undefined
return true

if x euqals undefined and y euqals null
return true

if Type(x) is Number and Type(y) is String
return x==ToNumber(y)         //ToNumber是一个真正的JS方法

if Type(x) is Boolean
return ToNumber(x)==y

if Type(x) is String or Number and Type(y) is Object
return x==ToPrimitive(y)

else
return false
```

### 通过ToPrimitive()将值转换为原始类型
ToPrimitive()定义如下：
```js
ToPrimitive(input, PreferredType?)
```
可选参数PreferredType可以是Number类型或String类型。如果PreferredType是Number类型，那么input值的转换如下：<br>
1.如果input为原始类型，则返回input本身。<br>
2.如果input为Object类型，调用obj.valueOf()。如果结果是原始类型，则返回这个结果。<br>
3.否则，调用obj.toString()。如果结果是原始类型，则返回obj.toString()的结果。<br>
4.否则，抛出一个错误。<br>
如果PreferredType是String类型，跳过2，3步骤。如果PreferredType不填，则设置传入Date的实例的PreferredType为String类型，其他所有类型的PreferredType为Number。

### 通过ToNumber()将值转换为Number类型
转换规则如下：<br>
1.如果值是undefined，返回NaN。<br>
2.如果值是null，返回+0。<br>
3.如果值是boolean，true转化为1，false转化为+0。<br>
4.如果值是Number类型，直接返回。<br>
5.如果值是String类型，解析String中的数值。例如"324"转换成324，"F123"转换成NaN。<br>
6.如果值是对象类型，先调用ToPrimitive(obj,Number)，然后调用ToNumber(primitive)。

### 通过ToString()将值转换为String类型
转换规则如下：<br>
| Argument      | Result                                                     |
| ------------- | ---------------------------------------------------------- |
| null          | "null"                                                     |
| boolean value | either "true" or "false"                                   |
| number value  | the number as a string, e.g. "1.765"                       |
| string value  | "no conversion necessary"                                  |
| object value  | 先调用ToPrimitive(obj, String),然后调用ToString(primitive) |

示例：
```js
console.log(NaN == NaN);    //false
console.log(false == false);    //true
console.log(null == undefined);   //true

console.log(Number(undefined));   //NaN
console.log(Number(null));    //0

let obj = {
    valueOf() {
        console.log("valueOf");
        return {}
    },

    toString() {
        console.log("toString");
        return {}
    }
}

//valueOf, toString, TypeError: Cannot convert object to primitive value
console.log(Number(obj));  
```

### {} + {}?

**加法运算**<br>

比如:
```
value1 + value2
```
计算这个表达式的步骤如下：<br>
1.将value1和value2转换成原始类型(primitives):
```js
prim1 := ToPrimitive(value1)
prim2 := ToPrimitive(value2)
```
2.如果prim1和prim2都是string类型，则返回字符串拼接的结果。
3.否则，将prim1和prim2都转换成number类型并返回它们相加的结果。

**示例**
```js
console.log([] + []);  //''
console.log([] + {});  //[object Object]
console.log(typeof {}.valueOf());   //object
console.log(typeof {}.toString());  //string
console.log({}.toString());   //[object Object]
console.log({} + {});   //[object Object][object Object]

console.log(+{});     //NaN
console.log(Number("[object Object]"));     //NaN
```











